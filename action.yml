name: 'Initialize job for hosted and self-hosted runner usage'
description: Pre-fetch commonly used GitHub and UnterrainerInformatik actions for self-hosted runners
runs:
  using: "composite"
  steps:
  - name: Pre-fetch actions (forced output) ‚öôÔ∏è
    shell: bash
    run: |
        echo "üì¶ Pre-fetching actions (GitHub + UnterrainerInformatik)..."

        # Simple list of actions (no associative arrays)
        GH_ACTIONS=(
          "actions/checkout@v4"
          "actions/upload-artifact@v4"
          "actions/download-artifact@v4"
          "actions/setup-node@v4"
          "actions/setup-java@v4"
          "actions/cache@v3"
        )

        UNTER_ACTIONS=(
          "UnterrainerInformatik/ssh-mkdir-action@v1"
          "UnterrainerInformatik/ssh-deploy-action@v1"
          "UnterrainerInformatik/ssh-run-action@v1"
          "UnterrainerInformatik/init-runner-action@master"
        )

        BASE_PATH="$RUNNER_WORKSPACE/_actions"

        clone_action() {
          local REPO=$1
          local VERSION=${REPO##*@}
          local PATH_PART=${REPO%@*}
          local OWNER=$(dirname "$PATH_PART")
          local NAME=$(basename "$PATH_PART")
          local TARGET="$BASE_PATH/$OWNER/$NAME/$VERSION"

          echo "üîÅ Checking $REPO ‚Üí $TARGET"

          if [ ! -f "$TARGET/action.yml" ]; then
            echo "üì• Cloning $REPO..."
            mkdir -p "$TARGET"
            git clone --depth=1 --branch "$VERSION" "https://github.com/$OWNER/$NAME.git" "$TARGET"
            echo "‚úÖ $REPO fetched"
          else
            echo "‚úÖ $REPO already available"
          fi
        }

        for entry in "${GH_ACTIONS[@]}"; do clone_action "$entry"; done
        for entry in "${UNTER_ACTIONS[@]}"; do clone_action "$entry"; done

  - name: Checkout repo üì¶
    uses: actions/checkout@v4